# –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è RBAC —Å–∏—Å—Ç–µ–º—ã —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏, —Ä–æ–ª—è–º–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏.  
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:** [–¢–ópython_EM_–∏—é–ª—å.docx](./–¢–ópython_EM_–∏—é–ª—å.docx)

## –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –°–æ–∑–¥–∞—Ç—å `.env` —Ñ–∞–π–ª

2. `.env` —Ñ–∞–π–ª (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å)
```env
DATABASE_URL=postgresql+asyncpg://auth_user:auth_password@postgres:5432/auth_system

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ JWT
SECRET_KEY=your-secret-key-change-in-production
REFRESH_SECRET_KEY=your-refresh-secret-key-change-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è cookies
ENVIRONMENT=development
COOKIE_SECURE=false
COOKIE_SAMESITE=lax
COOKIE_HTTPONLY=true

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
LOG_LEVEL=INFO
CORS_ORIGINS=http://localhost:3000,http://localhost:8080
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
```bash
docker-compose up --build
```

4. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ:
- http://localhost:8000 
- http://localhost:8000/docs

## –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:

### üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- **Email:** `admin@test.com`
- **–ü–∞—Ä–æ–ª—å:** `admin123`
- **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:** –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ä–µ—Å—É—Ä—Å–∞–º —Å–∏—Å—Ç–µ–º—ã
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
  - `GET /admin/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
  - `GET /admin/users` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - `PUT /admin/users/{id}/roles` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - `GET /admin/roles` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–æ–ª–µ–π
  - `POST /admin/roles` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ä–æ–ª–µ–π
  - `GET /admin/permissions` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
  - `GET /resources/system/config` - —Å–∏—Å—Ç–µ–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  - + –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥—Ä—É–≥–∏—Ö —Ä–æ–ª–µ–π

### üë§ –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- **Email:** `user@test.com`
- **–ü–∞—Ä–æ–ª—å:** `user123`
- **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:** 
  - –ß—Ç–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤
  - –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
  - `GET /resources/documents` - –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - `GET /resources/reports` - –ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤
  - `GET /resources/user-profiles` - –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª–µ–π
  - `GET /users/me` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
  - `PUT /users/me` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
  - `DELETE /users/me` - –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞

### üëÆ‚Äç‚ôÄÔ∏è –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä
- **Email:** `moderator@test.com`
- **–ü–∞—Ä–æ–ª—å:** `moderator123`
- **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
  - –°–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - –°–æ–∑–¥–∞–Ω–∏–µ –∏ —ç–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤
  - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
  - `POST /resources/documents` - —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - `DELETE /resources/documents/{id}` - —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - `POST /resources/reports` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤
  - `GET /resources/reports/export` - —ç–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤
  - + –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### üë©‚Äçüíº –ú–µ–Ω–µ–¥–∂–µ—Ä (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–æ–ª–µ–π)
- **Email:** `manager@test.com`
- **–ü–∞—Ä–æ–ª—å:** `manager123`
- **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:** –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:** –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏

### –û–±—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–¥–ª—è –≤—Å–µ—Ö)

#### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è `POST /auth/register`
```json
{
  "email": "newuser@test.com",
  "password": "password123",
  "first_name": "–ò–º—è",
  "last_name": "–§–∞–º–∏–ª–∏—è",
  "middle_name": "–û—Ç—á–µ—Å—Ç–≤–æ"
}
```

#### 2. –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É `POST /auth/login`
```json
{
  "email": "user@test.com",
  "password": "user123"
}
```
**–û—Ç–≤–µ—Ç:**
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer"
}
```

#### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ `POST /auth/refresh`
–ö–æ–≥–¥–∞ access_token –∏—Å—Ç–µ–∫–∞–µ—Ç (—á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ refresh_token:
```json
{
  "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}
```

#### 4. –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã `POST /auth/logout`
**–£–¥–∞–ª—è–µ—Ç HTTP-only cookies —Å —Ç–æ–∫–µ–Ω–∞–º–∏:**
- –£–¥–∞–ª—è–µ—Ç `access_token` cookie
- –£–¥–∞–ª—è–µ—Ç `refresh_token` cookie  
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `response.delete_cookie()` –¥–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏
- –ü–æ—Å–ª–µ logout —Ç–æ–∫–µ–Ω—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- ‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –≤ Swagger UI —Ç–æ–∫–µ–Ω—ã –Ω—É–∂–Ω–æ —É–¥–∞–ª—è—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "Logout"

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Swagger UI

#### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:
1. **–û—Ç–∫—Ä–æ–π—Ç–µ Swagger:** http://localhost:8000/docs
2. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ `/auth/login`:**
   - –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /auth/login`
   - –ù–∞–∂–º–∏—Ç–µ "Try it out"
   - –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: `user@test.com` / `user123`)
   - –ù–∞–∂–º–∏—Ç–µ "Execute"
   - **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `access_token` –∏–∑ –æ—Ç–≤–µ—Ç–∞**

3. **–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ Swagger:**
   - **–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Authorize" üîí** (—Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É)
   - **–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ:** `Bearer your_access_token_here`
   - –ü—Ä–∏–º–µ—Ä: `Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...`
   - **–ù–∞–∂–º–∏—Ç–µ "Authorize"** - —Ç–µ–ø–µ—Ä—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç —Å —Ç–æ–∫–µ–Ω–æ–º

#### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –∫–æ–≥–¥–∞ —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç (—á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç):

**–ü—Ä–∏–∑–Ω–∞–∫–∏ –∏—Å—Ç–µ–∫—à–µ–≥–æ —Ç–æ–∫–µ–Ω–∞:**
- –ü–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É `401 Unauthorized` 
- –í –æ—Ç–≤–µ—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "Token has expired" –∏–ª–∏ "Invalid token"

**–°–ø–æ—Å–æ–±—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

**–°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç refresh**
1. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /auth/refresh`
2. –ù–∞–∂–º–∏—Ç–µ "Try it out" 
3. –í body —É–∫–∞–∂–∏—Ç–µ –≤–∞—à `refresh_token`:
   ```json
   {
     "refresh_token": "–≤–∞—à_refresh_token_–∏–∑_–ø–µ—Ä–≤–æ–≥–æ_–ª–æ–≥–∏–Ω–∞"
   }
   ```
4. –ù–∞–∂–º–∏—Ç–µ "Execute"
5. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π `access_token`**
6. –°–Ω–æ–≤–∞ –Ω–∞–∂–º–∏—Ç–µ "Authorize" üîí –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω

**–°–ø–æ—Å–æ–± 2: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω**
1. –°–Ω–æ–≤–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `POST /auth/login` 
2. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã
3. –û–±–Ω–æ–≤–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é




## –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker-compose down
```